FROM stackai.azurecr.io/stackai/stackweb:latest

ARG NEXT_PUBLIC_INDEX_URL
ARG NEXT_PUBLIC_CHAT_BACKEND_URL
ARG NEXT_PUBLIC_STACKEND_URL
ARG NEXT_PUBLIC_URL
ARG NEXT_PUBLIC_VERCEL_ENV
ARG NEXT_PUBLIC_REACT_APP_ENV
ARG NEXT_PUBLIC_AIRTABLE_CLIENT_ID
ARG NEXT_PUBLIC_AIRTABLE_CODE_VERIFIER
ARG NEXT_PUBLIC_CHAMALEON_KEY
ARG NEXT_PUBLIC_DROPBOX_CLIENT_ID
ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
ARG NEXT_PUBLIC_HUBSPOT_CLIENT_ID
ARG NEXT_PUBLIC_NOTION_CLIENT_ID
ARG NEXT_PUBLIC_NOTION_OAUTH_CLIENT_ID
ARG NEXT_PUBLIC_OUTLOOK_CLIENT_ID
ARG NEXT_PUBLIC_POSTHOG_API_KEY
ARG NEXT_PUBLIC_POSTHOG_HOST
ARG NEXT_PUBLIC_SENTRY_DSN
ARG NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY
ARG NEXT_PUBLIC_TYPEFORM_CLIENT_ID
ARG NEXT_PUBLIC_SUPABASE_ANON_KEY
ARG NEXT_PUBLIC_SUPABASE_URL
ARG TIPTAP_PRO_TOKEN

RUN \
  if [ -f yarn.lock ]; then yarn run build; \
  elif [ -f package-lock.json ]; then npm run build; \
  elif [ -f pnpm-lock.yaml ]; then corepack enable pnpm && pnpm run build; \
  else echo "Lockfile not found." && exit 1; \
  fi


ENTRYPOINT ["node", ".next/standalone/server.js"]